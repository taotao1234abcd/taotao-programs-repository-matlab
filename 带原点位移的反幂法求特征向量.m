clear;close all;clc;

ep = 1e-10;  % 最大允许误差
% A = [3,0,-10;
%     -1,3,4;
%     0,1,-2];
A = [0,2,1, 2;
    -2,0,3, 0;
    -1,-3,1, 1;
    3, 5, 2, 6];

% A = [0,314.159265358979,0,0,294.708504089099,0,0,0,0,0,0,0,0,0,0,0,0;-314.159265358979,0,0,0,0,294.708504089099,0,0,0,0,0,0,0,0,0,0,0;0,5.97908876077110e-32,-96153.8461538462,314.159265358979,96153.8461538462,-5.64630750955678e-14,-1.24088383466034e-13,-2.48176766932068e-14,-2.48176766932068e-14,0,1.38519489783126e-14,0,2.68668167108371e-14,0,0,2.84217094304040e-14,1.46338041456512e-15;-5.97908876077110e-32,0,-314.159265358979,-96153.8461538462,5.64630750955678e-14,96153.8461538462,-6.92597448915631e-14,-1.38519489783126e-14,-1.38519489783126e-14,0,-2.48176766932068e-14,0,-2.46894208260298e-14,0,0,-1.46338041456512e-15,2.84217094304040e-14;0,3.46380668194498e-16,-96153.8461538462,1.27183522968382e-15,96014.0727803610,314.159265358979,582.129580769415,116.425916153883,116.425916153883,0,-64.9829502677956,0,-126.038943466206,0,0,-133.333333333333,-6.86508280180911;-3.46380668194498e-16,0,-1.27183522968382e-15,-96153.8461538462,-314.159265358979,96014.0727803610,324.914751338978,64.9829502677956,64.9829502677956,0,116.425916153883,0,115.824235866772,0,0,6.86508280180911,-133.333333333333;-4.81812582612450,-2.68922969460857,0,0,-2.52036522456286,-1.40673804848337,2.52036522456388,0,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,1000,0,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,500,100,0,0,0,0,2.32775643430237e-07,0,0,-87.3194371154122,-48.7372127008467;0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;0,0,0,0,0,0,0,0,0,0,0,0,45.6768628874030,0,0,48.7372127008467,-87.3194371154122;0,0,0,0,0,0,0,0,0,0,0,0,-1000,-558.148496740640,999.999997155345,0,0;0,0,0,0,0,0,0,0,0,0,0,1,-50,-27.9074248370320,49.9999998577673,0,0;0,0,0,0,916.472642975330,-297.780012761313,0,0,0,0,0,0,0,-909.090909090909,314.159265358979,0,0;0,0,0,0,297.780012761313,916.472642975330,0,0,0,0,0,0,0,-314.159265358979,-909.090909090909,0,0;916.472642975330,-297.780012761313,0,0,0,0,0,0,0,0,0,0,0,0,0,-909.090909090909,314.159265358979;297.780012761313,916.472642975330,0,0,0,0,0,0,0,0,0,0,0,0,0,-314.159265358979,-909.090909090909];

[~, L] = eig(A);
L = diag(L);  % L为A的特征值的行向量

[VR, L] = my_eig(A, L, ep)  % 右特征向量
L = diag(L);  % L为A的特征值的行向量
[VL, L] = my_eig(A', L, ep)
VL = conj(VL);  % 左特征向量  
[VR_mat, L, VL_mat] = eig(A)
A*VR - VR*L
VL'*A - L*VL'

Pm = abs(VR.*VL)
Pm_mat = abs(VR_mat.*VL_mat)



function [m, n] = my_eig(A, L, ep)
N = size(A, 1);  % A有几行
I = eye(N, N);
m = zeros(N, N);
n = zeros(N, N);
for i = 1:N
    lam = L(i);  % 特征值lam的精确值
    if lam == 0
        m(:, i) = zeros(N, 1);
        n(i, i) = 0;
    else
        p = lam - 0.01*lam*exp(1j*pi/2);  % 特征值lam的近似值
        u0 = ones(N, 1);  % 特征向量的随机初始值
        u0 = u0/max(abs(u0));
        v = inv(A - p * I) * u0;
        u = v / norm(abs(v));  % 对u的模归一化
        iter = 0;
        while max(abs(u - u0)) > ep
            u0 = u;
            v = inv(A - p * I) * u0;
            u = v / norm(abs(v));  % 对u的模归一化
            u = u*exp(-1j*angle(u(1)));  % 转动u使得其第一个元素的相角为0
            iter = iter + 1;
            if iter > 50
                error('迭代计算不收敛！')
            end
        end        
        % 相角是随机的，可以任意乘 exp(1j*rand_angle)), rand_angle为随机角度，都是这个特征向量
        m(:, i) = u;
        n(i, i) = lam;
    end
end
end
